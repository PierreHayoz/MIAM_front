'use client'
// components/SvgMorphLayersControlled.tsx
import { motion, useMotionValue, useTransform, animate } from "framer-motion";
import { interpolate as flubberInterpolate } from "flubber";
import { useEffect } from "react";


function useFlubberMorph(dFrom, dTo, on, duration = 0.9) {
    const t = useMotionValue(0); // <-- toujours 0 au départ
    const d = useTransform(
        t,
        [0, 1],
        [dFrom, dTo],
        { mixer: (a, b) => flubberInterpolate(a, b, { maxSegmentLength: 2 }) }
    );

    useEffect(() => {
        // anime depuis la valeur courante (0 au montage) vers la cible (0/1)
        const controls = animate(t, on ? 1 : 0, { duration, ease: "easeInOut" });
        return controls.stop;
    }, [on, duration, t]);

    return d;
}

export default function SvgMorphLayersControlled({
    active = {},
    duration = 0.9,
    width = 700,
    height = 190,
    fill = "#231f20",
}) {
    const { c1 = false, c2 = false, c3 = false, c4 = false } = active;

    // ---- tes paths (identiques à ceux envoyés) ----
    const path4_A = "M75.42,119.1c2.84,0,4.35-.86,5.27-2.12l8-10.28c2.64-4.12,12.12-2.07,10.96,3.21-.24,1.08-.47,2.1-.7,3.08-.8,3.39,1.4,6.17,4.89,6.17h28.16c1.46,0,2.64-1.18,2.64-2.64V37.3c0-1.47-1.19-2.67-2.67-2.67h-33.51c-1.8,0-2.83.69-3.7,1.86l-21.19,33.22c-2.87,4.21-9.39,4.19-12.51,0l-21.88-33.2c-.87-1.17-1.33-1.86-3.7-1.86H2.67c-1.47,0-2.67,1.19-2.67,2.67v79.19c0,1.47,1.19,2.67,2.67,2.67h28.17c3.52,0,5.72-2.8,4.89-6.22-.24-.98-.49-2-.74-3.04-1.26-5.24,8.32-7.31,10.96-3.2l7.26,9.13c1.83,2.25,2.74,3.28,6.02,3.28l16.2-.02h0";
    const path4_B = "M75.42,119.1c2.84,0,4.35-.86,5.27-2.12l8-10.28c2.64-4.12,12.12-2.07,10.96,3.21-.24,1.08-.47,2.1-.7,3.08-.8,3.39,1.4,6.17,4.89,6.17h28.16c1.46,0,2.64-1.18,2.64-2.64v-19.91l-62.67-14.74,62.67-22.2v-22.35c0-1.47-1.19-2.67-2.67-2.67h-33.51c-1.8,0-2.83.69-3.7,1.86l-21.19,33.22c-2.87,4.21-9.39,4.19-12.51,0l-21.88-33.2c-.87-1.17-1.33-1.86-3.7-1.86H2.67c-1.47,0-2.67,1.19-2.67,2.67v26.52l62.89,24.93L0,96.6v19.91c0,1.47,1.19,2.67,2.67,2.67h28.17c3.52,0,5.72-2.8,4.89-6.22-.24-.98-.49-2-.74-3.04-1.26-5.24,8.32-7.31,10.96-3.2l7.26,9.13c1.83,2.25,2.74,3.28,6.02,3.28l16.2-.02h0";
    const path3_A = "M184.88,119.31h-34.52c-1.52,0-2.75-1.23-2.75-2.75V37.5c0-1.52,1.23-2.75,2.75-2.75h34.52c1.52,0,2.75,1.23,2.75,2.75v79.06c0,1.52-1.23,2.75-2.75,2.75h0";
    const path3_B = "M184.88,119.31h-34.52c-1.52,0-2.75-1.23-2.75-2.75v-19.96l22.43.57-22.43-37.51v-22.16c0-1.52,1.23-2.75,2.75-2.75h34.52c1.52,0,2.75,1.23,2.75,2.75v22.16l-30.63-10.68 30.63,45.92v21.66c0,1.52-1.23,2.75-2.75,2.75h0";
    const path6 = "M174.2,28.59h-13.16c-7.9,0-14.99-6.4-14.99-14.3h0C146.04,6.4,153.14,0,161.04,0h13.16c7.9,0,15,6.4,15,14.3h0c0,7.9-7.1,14.3-15,14.3h0";
    const path2_A = "M243.61,84.1l3.14-17.93c.88-3.1,5.56-3.1,6.44,0l3.27,17.83c.53,2.4-1.28,4.68-3.74,4.71l-5.29.06c-2.48.03-4.34-2.25-3.82-4.68ZM226.35,34.86c-2.62,0-3.25.66-4,2.73l-5.77,15.74-5.24,14.28-6.94,18.92-11.05,30.12c-.47,1.54-.01,2.65,2.15,2.65h37.75c1.02,0,1.91-.69,2.2-1.66l1.88-6.63c.85-3.16,3.52-5.85,10.26-5.85h4.77c6.77,0,9.39,2.14,10.26,5.87l1.87,6.6c.3.95,1.18,1.66,2.2,1.66l37.63-.02c1.16,0,2.39-.79,1.8-2.63l-11.95-33.12-5.97-16.54-4.87-13.49-5.74-15.91c-.68-1.97-1.16-2.72-4-2.73h-47.24";
    const path2_B = "M243.61,84.1l3.14-17.93c.88-3.1,5.56-3.1,6.44,0l3.27,17.83c.53,2.4-1.28,4.68-3.74,4.71l-5.29.06c-2.48.03-4.34-2.25-3.82-4.68ZM226.35,34.86c-2.62,0-3.25.66-4,2.73l-5.77,15.74 29.99-3.21-42.17,36.41-11.05,30.12c-.47,1.54-.01,2.65,2.15,2.65h37.75c1.02,0,1.91-.69,2.2-1.66l1.88-6.63c.85-3.16,3.52-5.85,10.26-5.85h4.77c6.77,0,9.39,2.14,10.26,5.87l1.87,6.6c.3.95,1.18,1.66,2.2,1.66l37.63-.02c1.16,0,2.39-.79,1.8-2.63l-11.95-33.12-31.15,11.38 20.32-41.4-5.74-15.91c-.68-1.97-1.16-2.72-4-2.73h-47.24";
    const path5_A = "M386.65,119.1c2.84,0,4.35-.86,5.27-2.12l8-10.28c2.65-4.12,12.12-2.07,10.96,3.21-.24,1.08-.47,2.1-.7,3.08-.8,3.39,1.4,6.17,4.89,6.17h28.16c1.46,0,2.64-1.18,2.64-2.64V37.3c0-1.47-1.19-2.67-2.67-2.67h-33.51c-1.8,0-2.83.69-3.7,1.86l-21.19,33.22c-2.87,4.21-9.39,4.19-12.51,0l-21.87-33.2c-.87-1.17-1.33-1.86-3.71-1.86h-32.81c-1.47,0-2.67,1.19-2.67,2.67v79.19c0,1.47,1.19,2.67,2.67,2.67h28.17c3.52,0,5.72-2.8,4.89-6.22-.24-.98-.49-2-.74-3.04-1.26-5.24,8.32-7.31,10.96-3.2l7.26,9.13c1.83,2.25,2.74,3.28,6.02,3.28l16.2-.02h0";
    const path5_B = "M386.65,119.1c2.84,0,4.35-.86,5.27-2.12l8-10.28c2.65-4.12,12.12-2.07,10.96,3.21-.24,1.08-.47,2.1-.7,3.08-.8,3.39,1.4,6.17,4.89,6.17h28.16c1.46,0,2.64-1.18,2.64-2.64v-23.31l-80.24-4.42,80.24-24.93v-26.54c0-1.47-1.19-2.67-2.67-2.67h-33.51c-1.8,0-2.83.69-3.7,1.86l-21.19,33.22c-2.87,4.21-9.39,4.19-12.51,0l-21.87-33.2c-.87-1.17-1.33-1.86-3.71-1.86h-32.81c-1.47,0-2.67,1.19-2.67,2.67v22.33l32.85-9.54-32.85,44.22v22.18c0,1.47,1.19,2.67,2.67,2.67h28.17c3.52,0,5.72-2.8,4.89-6.22-.24-.98-.49-2-.74-3.04-1.26-5.24,8.32-7.31,10.96-3.2l7.26,9.13c1.83,2.25,2.74,3.28,6.02,3.28l16.2-.02h0";
const path2_A_sub1 =
  "M243.61,84.1l3.14-17.93c.88-3.1,5.56-3.1,6.44,0l3.27,17.83c.53,2.4-1.28,4.68-3.74,4.71l-5.29.06c-2.48.03-4.34-2.25-3.82-4.68Z";
const path2_A_sub2 =
  "M226.35,34.86c-2.62,0-3.25.66-4,2.73l-5.77,15.74-5.24,14.28-6.94,18.92-11.05,30.12c-.47,1.54-.01,2.65,2.15,2.65h37.75c1.02,0,1.91-.69,2.2-1.66l1.88-6.63c.85-3.16,3.52-5.85,10.26-5.85h4.77c6.77,0,9.39,2.14,10.26,5.87l1.87,6.6c.3.95,1.18,1.66,2.2,1.66l37.63-.02c1.16,0,2.39-.79,1.8-2.63l-11.95-33.12-5.97-16.54-4.87-13.49-5.74-15.91c-.68-1.97-1.16-2.72-4-2.73h-47.24";

// B
const path2_B_sub1 =
  "M243.61,84.1l3.14-17.93c.88-3.1,5.56-3.1,6.44,0l3.27,17.83c.53,2.4-1.28,4.68-3.74,4.71l-5.29.06c-2.48.03-4.34-2.25-3.82-4.68Z";
const path2_B_sub2 =
  "M226.35,34.86c-2.62,0-3.25.66-4,2.73l-5.77,15.74 29.99-3.21-42.17,36.41-11.05,30.12c-.47,1.54-.01,2.65,2.15,2.65h37.75c1.02,0,1.91-.69,2.2-1.66l1.88-6.63c.85-3.16,3.52-5.85,10.26-5.85h4.77c6.77,0,9.39,2.14,10.26,5.87l1.87,6.6c.3.95,1.18,1.66,2.2,1.66l37.63-.02c1.16,0,2.39-.79,1.8-2.63l-11.95-33.12-31.15,11.38 20.32-41.4-5.74-15.91c-.68-1.97-1.16-2.72-4-2.73h-47.24";

    // morphs
    const d4 = useFlubberMorph(path4_A, path4_B, c1, duration);
    const d3 = useFlubberMorph(path3_A, path3_B, c2, duration);
    const d2 = useFlubberMorph(path2_A, path2_B, c3, duration);
    const d5 = useFlubberMorph(path5_A, path5_B, c4, duration);
const d2_sub1 = useFlubberMorph(path2_A_sub1, path2_B_sub1, c3, duration);
const d2_sub2 = useFlubberMorph(path2_A_sub2, path2_B_sub2, c3, duration);
    return (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 445.87 119.31" width={width} height={height}>
            <g id="Calque_1"><motion.path d={d4} fill={fill} /></g>
            <g id="Calque_2">
                <motion.path d={d3} fill={fill} />
                <path d={path6} fill={fill} />
            </g>
            <g id="Calque_3">
                <motion.path d={d2_sub1} fill={fill} />
                <motion.path d={d2_sub2} fill={fill} />
            </g>
            <g id="Calque_4"><motion.path d={d5} fill={fill} /></g>
        </svg>
    );
}